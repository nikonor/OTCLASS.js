<!DOCTYPE html>
<!-- saved from url=(0066)http://twitter.github.com/bootstrap/examples/starter-template.html -->
<html lang="ru">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Demo for OTCLASS.js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Demo for OTCLASS.js">
    <meta name="author" content="nikonor">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="http://twitter.github.com/bootstrap/assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Demo for OTCLASS.js</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#">Список</a></li>
            </ul>
          </div><!--/.nav-collapse -->
          <div class="nav-collapse pull-right">
            <ul class="nav">
              <li><a href="https://docs.google.com">Помощь</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="well span12" style="display: none; color: blue;" id="divDebug"></div>
    <div class="well span12" style="display: none; color: red;" id="divError"></div>
    <div class="well span12" style="display: none; color: green ;" id="divMessage"></div>
    <div id="div_shadow" class="shadow" style="left: 0px; top: 0px; width: 100%; height: 100%; position: fixed; background-color: rgb(0, 0, 0); z-index: 10; opacity: 0.7; display: none; ">
      <img src="img/ajax-loader.gif" style="position: absolute; left: 50%; top: 50%;">
    </div>

    <h3>Handlebars:</h3><br>
    <div class="container" id="container">
      <h1>Bootstrap starter template</h1>
      <p>Use this document as a way to quick start any new project.<br> All you get is this message and a barebones HTML document.</p>

    </div> <!-- /container -->

    <h3>jquery-tmpl:</h3><br>
    <div class="container" id="jcontainer">
    </div>


    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script language="JavaScript" src="js/jquery.js"></script>
    <script language="JavaScript" src="js/otmes.js"> </script>
    <script language="JavaScript" src="js/func.js"></script>
    <script language="JavaScript" src="js/handlebars-1.0.0.beta.6.js"> </script>
    <script language="JavaScript" src="js/jquery.tmpl.min.js"></script>
    <script language="JavaScript" src="../otclass.js"></script>
    <script language="JavaScript" src="js/func.js"></script>
    <script language="JavaScript" src="js/bootstrap-transition.js"></script>
    <script language="JavaScript" src="js/bootstrap-alert.js"></script>
    <script language="JavaScript" src="js/bootstrap-modal.js"></script>
    <script language="JavaScript" src="js/bootstrap-dropdown.js"></script>
    <script language="JavaScript" src="js/bootstrap-scrollspy.js"></script>
    <script language="JavaScript" src="js/bootstrap-tab.js"></script>
    <script language="JavaScript" src="js/bootstrap-tooltip.js"></script>
    <script language="JavaScript" src="js/bootstrap-popover.js"></script>
    <script language="JavaScript" src="js/bootstrap-button.js"></script>
    <script language="JavaScript" src="js/bootstrap-collapse.js"></script>
    <script language="JavaScript" src="js/bootstrap-carousel.js"></script>
    <script language="JavaScript" src="js/bootstrap-typeahead.js"></script>


<script type="text/javascript">
  var _d = '1';
  var demo;
  var jdemo;

  var tmp_data = {'list':[
    {'id':1,'name':'Иванов','age':21},
    {'id':2,'name':'Петров','age':20},
    {'id':3,'name':'Сидоров','age':22},
  ]};

  var jtmp_data = {'list': [
    {id: 1, name: 'Чалкин', weight: 142, ears: 1},
    {id: 2, name: 'Палкин', weight: 67, ears: 3},
    {id: 3, name: 'Залкинд', weight: 13, ears: 2},
  ]};

  function _dark(){
    $('#div_shadow').show();
  }

  function _light(){
    $('#div_shadow').hide();
  }

  var add_row = function(o){
    mes.d('call add_row');
    o.add({'name':'Джон До','age':25, 'weight': 78, ears: 12});
  }

  var remove_row_with_param = function(o, id, param){
    mes.d('call remove_row with id='+id);
    o.remove([ {'field':'id','eq':id},
                param
                ]);
  }


  var remove_row = function(o, id){
    mes.d('call remove_row with id='+id);
    o.remove({'field':'id','eq':id});
  }

  var find_row = function(){
    mes.beforesave();
    var r = demo.get({'field':'age','eq':$('#age4del').val()});
    if (r){
      mes.m(r);
    }else{
      mes.e('Не удалось найти людей такого возвраста');
    }
  }


  var beginEdit = function (){
    mes.d('call beginEdit from td with id='+this.id);
    var a = this.id.split('-');
    tmpl = Handlebars.compile($("#edit").html());
    view = tmpl({'field':a[1],'id':a[2],'val':trimStr($(this).html())});
    $(this).empty().append(view);

  }

  var saveEdit = function(f,i){
    mes.d('call saveEdit');
    // var a = this.id.split('-');
    demo.update_item({'field':'id','eq':i},f,$('#new_val_'+f+'_'+i).val());
  }

  var cancelEdit = function(f,i){
    mes.d('call cancelEdit');
    $('#td-'+f+'-'+i).html( $('#old_val_'+f+'_'+i).val() );
  }


  $(document).ready(function(){
    _dark();

    mes = new otmes(_d);
    mes.d('--- Start of demo ---');

    $('.editable').live('dblclick', beginEdit);

    demo = new OTCLASS({
      'id':'demo',
      'data':tmp_data,
      'div_id': 'container',
      'tmpl_id': 'tmpl',
      'sort':'age',
      'debug':1
    });

    jdemo = new OTCLASS({
      id        : 'jdemo',
      data      : jtmp_data,
      div_id    : 'jcontainer',
      tmpl_id   : 'jtmpl',
      sort      : 'weight',
      debug     : 1,
      tmpl_type : 'jquery-tmpl'
    });

    _light();
  });
</script>

<script id="edit" type="text/x-handlebars-template">
  <input type=hidden id="old_val_{{field}}_{{id}}" value="{{val}}">
  <input type=text id="new_val_{{field}}_{{id}}" class="input-small" value="{{val}}">
  <a href="#" class="btn btn-small btn-primary" onClick="saveEdit('{{field}}',{{id}});">Save</a>
  <a href="#" class="btn btn-small btn-primary" onClick="cancelEdit('{{field}}',{{id}});">Cancel</a>
</script>


<script id="tmpl2" type="text/x-handlebars-template">
  <a href="#" class="btn btn-small btn-primary" onClick="add_row();">+</a>
  <select id="sel">
    <option value="">---
    {{#each list}}
      <option value="{{id}}">{{name}}
    {{/each}}
  </select>
</script>

<script id="tmpl" type="text/x-handlebars-template">
  <div class="alert alert-warning">
    Чтобы исправить имя или возраст, сделайте двойной клик на нужном поле
  </div>
  Возраст: <input id="age4del" value="21" class="input-mini">
  <a href="#" class="btn btn-small btn-primary" onClick="find_row();"><i class="icon-search icon-white"></i> Найти людей по возрасту</a>
  <br><br>

  <table id="t" class="table table-bordered">
    <thead>
      <tr>
        <th>
          Имя
        </th>
        <th>
          Возраст
        </th>
        <th>
          <a href="#" class="btn btn-small btn-primary" onClick="add_row(demo);">+</a>
        </th>
      </tr>
    </thead>
    <tbody>
      {{#each list}}
        <tr>
          <td class="editable" id="td-name-{{id}}">
            {{name}}
          </td>
          <td class="editable" id="td-age-{{id}}">
            {{age}}
          </td>
          <td>
            <a href="#" class="btn btn-small btn-primary" onClick="remove_row(demo, {{id}});">Удалить</a>
            <a href="#" class="btn btn-small btn-primary" onClick="remove_row_with_param(demo, {{id}}, {'field':'age','eq':$('#age4del').val()});">Удалить, если возраст совпадает</a>
          </td>
        </tr>
      {{/each}}
    </tbody>
  </table>
</script>

<script id="jtmpl" type="text/x-jquery-tmpl">
  <div class="row">
    <div class="span4">
      <table id="jt" class="table table-bordered">
        <thead>
          <tr style="background-color: #ccc; text-align: center;">
            <th style="text-align: center;">
              Фамилия
            </th>
            <th style="text-align: center;">
              Вес
            </th>
            <th style="text-align: center;">
              Количество ушей
            </th>
          </tr>
        </thead>
        <tbody>
          {{each(i, v) list}}
            <tr>
              <td id="jtd-name-${v.id}">
                ${v.name}
              </td>
              <td id="jtd-weight-${v.id}" style="text-align: right;">
                ${v.weight}
              </td>
              <td id="jtd-ears-${v.id}" style="text-align: right;">
                ${v.ears}
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
      <a href="#" class="btn btn-small btn-primary" onClick="add_row(jdemo);">Добавить строку</a>
      <br><br>
    </div>
  </div>
</script>

  
  </body>
</html>